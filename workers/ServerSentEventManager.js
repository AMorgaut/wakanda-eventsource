var ports = [];var ServerSentEvent = require("serverSentEvent").ServerSentEvent;onconnect = function(msg) {	var port = msg.ports[0];	port.onmessage = function (event) {		var message = event.data;		switch (message.type) {			case ServerSentEvent.SEND_DATAS :				ports.forEach(function(sseHandler) {					if (sseHandler !== undefined) // Totally silly to have this test, the spec should evolve and clear the "element is present"						sseHandler.postMessage({type:ServerSentEvent.SEND_DATAS, message:message.data});				});				break;			case "register" :				ports.push(port);				port.postMessage({type:"ack", ref:ports.length});				break;			case "disconnect" :				ports[message.ref - 1] = undefined;		}	};};